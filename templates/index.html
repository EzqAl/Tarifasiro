<!DOCTYPE html>
<html lang="es">
<head>
    <!-- ... (el head sigue igual) ... -->
</head>
<body>
    <div class="container">
        <h1>Calculador de Envíos</h1>
        
        <!-- Paso 1: Selección de tipo de envío -->
        {% if not session.tipo_envio %}
        <form id="envioForm" method="POST" action="{{ url_for('inicio') }}">
            <label for="tipo_envio">Tipo de envío:</label>
            <select name="tipo_envio" id="tipo_envio" required>
                <option value="bulto">Bulto</option>
                <option value="pallet">Pallet</option>
            </select>
            <button type="submit">Siguiente</button>
        </form>
        {% endif %}

        <!-- Paso 2: Selección de localidad -->
        {% if session.tipo_envio and not session.localidad %}
        <form method="POST" action="{{ url_for('localidad') }}">
            <label for="localidad">Localidad:</label>
            <select name="localidad" id="localidad" required>
                {% for localidad in localidades %}
                    <option value="{{ localidad }}">{{ localidad }}</option>
                {% endfor %}
            </select>
            <button type="submit">Siguiente</button>
        </form>
        {% endif %}

        <!-- Paso 3: Formulario para pallets -->
        {% if session.tipo_envio == 'pallet' and session.localidad and not session.fragil %}
        <form method="POST" action="{{ url_for('pallet') }}">
            <label>¿Es frágil?</label>
            <label><input type="radio" name="fragil" value="si" required> Sí</label>
            <label><input type="radio" name="fragil" value="no"> No</label>

            <label>¿Es pesado? (+15%)</label>
            <label><input type="radio" name="pesado" value="si" required> Sí</label>
            <label><input type="radio" name="pesado" value="no"> No</label>
            
            <button type="submit">Siguiente</button>
        </form>
        {% endif %}

        <!-- Paso 3: Cantidad de bultos -->
        {% if session.tipo_envio == 'bulto' and session.localidad and not session.cantidad_bultos %}
        <form method="POST" action="{{ url_for('cantidad_bultos') }}">
            <label for="cantidad">Cantidad de bultos:</label>
            <input type="number" name="cantidad" id="cantidad" min="1" required>
            <button type="submit">Siguiente</button>
        </form>
        {% endif %}

        <!-- Paso 4: Selección de categorías -->
        {% if session.cantidad_bultos and not session.categorias %}
        <form method="POST" action="{{ url_for('seleccion_categorias') }}">
            {% for i in range(session.cantidad_bultos) %}
            <div class="bulto">
                <h3>Bulto {{ i+1 }}</h3>
                <select name="categoria" required>
                    <option value="Chica">Chica</option>
                    <option value="Mediana">Mediana</option>
                    <option value="Grande">Grande</option>
                    <option value="XL">XL</option>
                    <option value="XXL">XXL</option>
                    <option value="M3">M3</option>
                    <option value="Donación">Donación</option>
                </select>
                <label>
                    <input type="checkbox" name="pesado" value="{{ i }}">
                    ¿Es pesado? (+15%)
                </label>
            </div>
            {% endfor %}
            <button type="submit">Siguiente</button>
        </form>
        {% endif %}

        <!-- Paso 5: Valor declarado -->
        {% if (session.categorias or session.fragil) and not session.valor_declarado %}
        <form method="POST" action="{{ url_for('valor_declarado') }}">
            <label for="valor">Valor declarado:</label>
            <input type="number" step="0.01" name="valor" id="valor" required>
            <button type="submit">Calcular</button>
        </form>
        {% endif %}

        <!-- Resultados -->
        {% if total %}
        <div id="resultado">
            <h2>Resultado</h2>
            <p>Total base: ${{ "%.2f"|format(total_base) }}</p>
            <p>Seguro: ${{ "%.2f"|format(seguro) }}</p>
            <p>IVA (21%): ${{ "%.2f"|format(iva) }}</p>
            <h3>Total: ${{ "%.2f"|format(total) }}</h3>
        </div>
        {% endif %}
    </div>
</body>
</html>
