<!-- Scripts modificados -->
<script>
    // Generar campos dinámicos
    function generarCampos(cantidad, tipo) {
        const contenedor = document.getElementById('detalles');
        contenedor.innerHTML = '';
        
        for (let i = 0; i < cantidad; i++) {
            let html = `
                <div class="form-group">
                    <h3>${tipo === 'pallet' ? 'Pallet' : 'Bulto/Caja'} ${i + 1}</h3>
                    <label>Pesado</label>
                    <select name="pesado_${i}" required>
                        <option value="si">Sí</option>
                        <option value="no">No</option>
                    </select>
                    <label>Frágil</label>
                    <select name="fragil_${i}" required>
                        <option value="si">Sí</option>
                        <option value="no">No</option>
                    </select>
            `;

            if (tipo === 'bultos') {
                html += `
                    <label>Categoría</label>
                    <select name="categoria_${i}" required>
                        {% for loc in localidades %}
                            {% if loop.first %}
                                {% for cat in PRECIOS[loc].keys() %}
                                    {% if not cat.startswith('Pallet') %}
                                        <option value="{{ cat }}">{{ cat }}</option>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        {% endfor %}
                    </select>
                `;
            }

            html += '</div>';
            contenedor.innerHTML += html;
        }
    }

    // Eventos
    document.addEventListener('DOMContentLoaded', () => {
        const tipoEnvio = document.querySelector('select[name="tipo_envio"]');
        const cantidad = document.querySelector('input[name="cantidad"]');
        
        tipoEnvio.addEventListener('change', () => {
            generarCampos(cantidad.value, tipoEnvio.value);
        });

        cantidad.addEventListener('input', () => {
            generarCampos(cantidad.value, tipoEnvio.value);
        });

        // Campos iniciales
        generarCampos(1, tipoEnvio.value);
    });

    // Nueva Cotización (scroll + reset)
    function nuevaCotizacion() {
        document.getElementById('cotizadorForm').reset();
        generarCampos(1, document.querySelector('select[name="tipo_envio"]').value);
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
</script>

<!-- Botón modificado -->
<button onclick="nuevaCotizacion()">Nueva Cotización</button>
